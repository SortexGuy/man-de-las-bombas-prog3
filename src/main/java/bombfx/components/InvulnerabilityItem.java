package bombfx.components;

import javafx.geometry.Point2D;
import javafx.scene.canvas.GraphicsContext;
import javafx.scene.paint.Color;
import javafx.scene.shape.Rectangle;


/**
 * Clase que representa un ítem de invulnerabilidad en el juego.
 * Los ítems de invulnerabilidad otorgan al jugador un periodo de invulnerabilidad temporal.
 */
public class InvulnerabilityItem extends ItemCell {

    /**
     * Constructor que inicializa la posición del ítem de invulnerabilidad, el jugador y el nivel.
     * @param pos La posición inicial del ítem de invulnerabilidad.
     * @param player El jugador que puede recoger el ítem de invulnerabilidad.
     * @param level El nivel en el que se encuentra el ítem de invulnerabilidad.
     */
    public InvulnerabilityItem(Point2D pos, Player player, Level level) {
        super(pos, player, level);
        this.collRect = new Rectangle(pos.getX() + 4, pos.getY() + 4, SIZE - 8, SIZE - 8);
    }

    /**
     * Método para actualizar el estado del ítem de invulnerabilidad en cada fotograma del juego.
     * Si el jugador se superpone con el ítem de invulnerabilidad, se activa la invulnerabilidad del jugador por un tiempo determinado.
     * Además, se elimina el ítem de invulnerabilidad del nivel.
     * @param delta El tiempo transcurrido desde el último fotograma, en segundos.
     */
    @Override
    public void update(double delta) {
        if (this.overlap(player.getCollRect())) {
            player.activateInvulnerability(2.0);// Activar invulnerabilidad del jugador por 2 segundos
            Point2D newPos = new Point2D(pos.getX() + SIZE / 2, pos.getY() + SIZE / 2);
            level.removeItem( newPos);// Eliminar el ítem de invulnerabilidad del nivel
        }
    }

    /**
     * Método para dibujar el ítem de invulnerabilidad en el contexto gráfico dado.
     * @param gContext El contexto gráfico en el que se dibujará el ítem de invulnerabilidad.
     */
    @Override
    public void draw(GraphicsContext gContext) {
        super.draw(gContext);

        Color c = Color.DARKSALMON;
        gContext.setFill(c);
        gContext.beginPath();
        gContext.rect(pos.getX() + 8, pos.getY() + 8, SIZE - 16, SIZE - 16);
        gContext.closePath();
        gContext.fill();
        gContext.setStroke(Color.BLACK);
        gContext.setLineWidth(1);
        gContext.stroke();
    }
    
}
